<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>

    <header>
 
        <h1>Main</h1>

        <nav>
            <ul>

              <li><a href="#">Categorias</a></li>
              <li><a href="#">Seus Filmes</a></li>
              <li><a href="#">Colaboradores</a></li>
              
            </ul>
        </nav>

        <form action="/search" method="get">
            <input type="text" name="q" placeholder="Pesquisar...">
            
            <button id="pesquisar" type="submit">

                <svg fill="#000000" height="800px" width="800px" id="Layer_1" data-name="Layer 1"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                    <path class="cls-1" d="M13.07336,12.29053,10.14679,9.364a3.9711,3.9711,0,1,0-.78284.78284l2.92658,2.92657Zm-6.064-2.4516A2.82914,2.82914,0,1,1,9.8385,7.00934,2.83286,2.83286,0,0,1,7.00934,9.83893Z"/>
                </svg>

            </button> 
        </form>

        
        <div id="user">
            <img src="" alt="" >
            
        </div>

    </header>



    <main>

        <ul id="lista">
    
        </ul>
    
        
        <button id="erase" onclick="erase()">apagar token</button>

    </main>
    
    

    <footer></footer>
   
    <script>

       window.onload = async () => {

        const token = localStorage.getItem("token");

        if(!token){
            alert("token não encontrado, faça login... redirecionando para login");
            window.location.href = "login.html";

            return;
        }

        const res = await fetch('http://localhost:7000/page', {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });


        if (!res.ok) {
            localStorage.removeItem("token");
            alert("Você não está logado ou o token expirou. Redirecionando para login...");
            window.location.href = "login.html";
        }

        const data = await res.json();

        if (res.ok) {
            console.log("Usuário logado:", data.usuario);
            // Exibir dados na tela, etc
        } else {
            alert("Você não está logado ou o token expirou. Redirecionando para login...");
            window.location.href = "login.html";
            
        }
    };

    function erase(){
        localStorage.removeItem("token");
        window.location.href = "login.html";
    }

    </script>
</body>
</html>